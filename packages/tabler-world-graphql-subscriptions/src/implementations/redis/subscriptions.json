{
    "script": "-- docker run -ti --network host --rm redis redis-cli -h host.docker.internal EVAL \"$(cat subscriptions.lua)\" 2 \"dev:ws:trigger:ALL(:14225:)\" \"ALL(:14225:)\" \"dev:ws:subscription:\"\n-- docker run -ti --network host --rm redis redis-cli -h host.docker.internal SCRIPT LOAD \"$(cat subscriptions.lua)\"\n\nlocal triggerKey  = KEYS[1] -- dev:ws:trigger:ALL(:14225:)\nlocal prefix      = KEYS[2] -- dev:ws:subscription:\nlocal triggerHash = ARGV[1] -- ALL(:14225:)\n\n-- this lists all subscriptions for the given trigger\nlocal subscriptions = redis.call(\"HGETALL\", triggerKey)\nlocal result = {}\n\nlocal temp\nlocal connection\nlocal subscription\n\nfor idx = 1, #subscriptions, 2 do\n    subscription = subscriptions[idx]\n    connection = string.gsub(subscription, \"\\:.*\", \"\")\n    temp = redis.call(\"HMGET\", prefix .. connection, triggerHash)\n\n    -- connection does no longer exist for connection\n    if (temp[1] == false) then\n        redis.call(\"HDEL\", triggerKey, subscription)\n    else\n        result[subscription] = subscriptions[idx + 1]\n    end\nend\n\nreturn cjson.encode(result)",
    "sha1": "b7ca5ca63e48d031e2fa4210516909200177147b"
}